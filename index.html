<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WOLCAS ‚Äî Secure Online App</title>
  <!-- Content Security Policy (best-effort for GitHub Pages via meta) -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdn.jsdelivr.net https://alcdn.msauth.net https://login.microsoftonline.com https://graph.microsoft.com; img-src 'self' data: https://*.sharepoint.com https://graph.microsoft.com; style-src 'self' 'unsafe-inline'; script-src 'self' https://cdn.jsdelivr.net https://alcdn.msauth.net; connect-src 'self' https://login.microsoftonline.com https://graph.microsoft.com https://architektica-my.sharepoint.com; frame-ancestors 'self'; frame-src https://login.microsoftonline.com;" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text y='14' font-size='14'>üèóÔ∏è</text></svg>">
  <style>
    :root{
      --accent:#0067b8; /* Microsoft blue */
      --muted:#f5f6f8;
      --text:#222;
      --danger:#c43e1c;
      --ok:#107c10;
    }
    html,body{height:100%;background:#fff;color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;}
    *{box-sizing:border-box}
    a{color:var(--accent)}
    header{
      position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid #e5e7eb;
      display:flex;align-items:center;gap:.75rem;padding:.5rem .75rem;
    }
    .logo{height:56px;}
    .app-title{font-weight:600;letter-spacing:.2px}
    .left{display:flex;align-items:center;gap:.5rem;margin-left:auto}
    .email{color:#555;font-size:.9rem}

    main{max-width:1100px;margin:1rem auto;padding:0 1rem}

    .card{background:#fff;border:1px solid #e5e7eb;border-radius:10px;box-shadow:0 1px 2px rgba(0,0,0,.04);padding:1rem}
    .warning{border-left:4px solid var(--danger);padding-left:.75rem}

    .grid{display:grid;grid-template-columns:1fr;gap:1rem}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}

    .toolbar{display:flex;align-items:center;justify-content:space-between;margin:.25rem 0 .75rem 0}
    .btn{appearance:none;border:1px solid #d1d5db;background:#fff;color:#111; padding:.35rem .65rem;border-radius:8px;cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    .btn.danger{background:#fff;color:var(--danger);border-color:var(--danger)}
    .btn:disabled{opacity:.5;cursor:not-allowed}

    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid #eee;padding:.5rem;text-align:left}
    th{background:var(--muted);}

    dialog{border:none;border-radius:10px;padding:0;max-width:680px;width:95vw}
    .modal{padding:1rem}
    .modal .row{display:grid;grid-template-columns:1fr 1fr;gap:.5rem}
    .modal label{font-size:.85rem;color:#555}
    .modal input,.modal textarea,.modal select{width:100%;padding:.5rem;border:1px solid #d1d5db;border-radius:8px}
    .modal textarea{min-height:84px}
    .hidden{display:none !important}
    .rbac-note{font-size:.8rem;color:#666}

    .footer-note{margin-top:1rem;color:#666;font-size:.9rem}
  </style>
  <!-- MSAL Browser -->
  <script defer src="https://cdn.jsdelivr.net/npm/@azure/msal-browser@3.11.1/dist/msal-browser.min.js"></script>
</head>
<body>
  <header>
    <img class="logo" alt="WOLCAS Logo" src="https://upload.wikimedia.org/wikipedia/commons/5/59/Windows_Logo.svg" />
    <div class="app-title">WOLCAS</div>
    <div class="left">
      <span class="email" id="userEmail">Not signed in</span>
      <button class="btn" id="signinBtn">Sign in</button>
      <button class="btn" id="signoutBtn" disabled>Sign out</button>
    </div>
  </header>

  <main>
    <!-- Sign-in required card -->
    <section id="signinCard" class="card">
      <h2>Welcome</h2>
      <p>Sign in with your company account to continue.</p>
      <p class="warning">All features are locked until you sign in.</p>
      <button class="btn primary" id="signinStart">Sign in</button>
    </section>

    <!-- App content (hidden until auth) -->
    <section id="appContent" class="hidden">
      <div class="grid">
        <!-- Projects Panel -->
        <div class="card">
          <div class="toolbar">
            <h3>Projects</h3>
            <button class="btn primary" id="addProjectBtn">Add Project</button>
          </div>
          <table id="projectsTable">
            <thead>
              <tr>
                <th>Title</th>
                <th>Owner</th>
                <th>Start Date</th>
                <th>Expected Sales</th>
                <th>Active</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Tasks Panel -->
        <div class="card">
          <div class="toolbar">
            <h3>Tasks</h3>
            <button class="btn primary" id="addTaskBtn">Add Task</button>
          </div>
          <table id="tasksTable">
            <thead>
              <tr>
                <th>Title</th>
                <th>Address</th>
                <th>Start</th>
                <th>End</th>
                <th>Quantity</th>
                <th>Unit Cost</th>
                <th>Total Cost</th>
                <th>Allocation</th>
                <th>Sprint</th>
                <th>Assignee</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <p class="rbac-note">Role-based Access (RBAC): Admin, Editor, Viewer. Only Admins can delete items and change the <strong>Allocation</strong> field.</p>
    </section>

    <p class="footer-note">Hosted at <a href="https://abirrahat.github.io/wolcas-webapp/" target="_blank" rel="noopener">GitHub Pages</a>.</p>
  </main>

  <!-- Project Modal -->
  <dialog id="projectModal">
    <form method="dialog" class="modal" id="projectForm">
      <h3>Project editor</h3>
      <div class="row">
        <div>
          <label>Title (Project Address)</label>
          <input name="Title" placeholder="e.g., 123 Main St" required />
        </div>
        <div>
          <label>Owner</label>
          <input name="Owner" placeholder="Company/Client" />
        </div>
        <div>
          <label>Start Date</label>
          <input type="date" name="StartDate" />
        </div>
        <div>
          <label>Expected Sales</label>
          <input type="number" step="0.01" name="ExpectedSales" />
        </div>
        <div>
          <label>Active</label>
          <input type="checkbox" name="Active" />
        </div>
      </div>
      <div style="display:flex;gap:.5rem;margin-top:.75rem">
        <button class="btn primary" id="projectSave">Save</button>
        <button class="btn danger" id="projectDelete">Delete</button>
        <button class="btn" value="cancel">Close</button>
      </div>
    </form>
  </dialog>

  <!-- Task Modal -->
  <dialog id="taskModal">
    <form method="dialog" class="modal" id="taskForm">
      <h3>Task editor</h3>
      <div class="row">
        <div>
          <label>Title</label>
          <input name="Title" placeholder="Task name" required />
        </div>
        <div>
          <label>Address</label>
          <input name="Address" placeholder="Task address" />
        </div>
        <div>
          <label>Start Date</label>
          <input type="date" name="StartDate" />
        </div>
        <div>
          <label>End Date</label>
          <input type="date" name="EndDate" />
        </div>
        <div>
          <label>Quantity</label>
          <input type="number" step="0.01" name="Quantity" />
        </div>
        <div>
          <label>Unit Cost</label>
          <input type="number" step="0.01" name="UnitCost" />
        </div>
        <div>
          <label>Total Cost</label>
          <input type="number" step="0.01" name="TotalCost" />
        </div>
        <div>
          <label>Allocation</label>
          <input type="number" step="0.01" name="Allocation" id="AllocationInput" />
        </div>
        <div>
          <label>Sprint</label>
          <input name="Sprint" />
        </div>
        <div>
          <label>Assignee</label>
          <input name="Assignee" />
        </div>
        <div style="grid-column:1/3">
          <label>Description</label>
          <textarea name="Description"></textarea>
        </div>
        <div style="grid-column:1/3">
          <label>Notes</label>
          <textarea name="Notes"></textarea>
        </div>
        <div style="grid-column:1/3">
          <label>Photos (multiple)</label>
          <input type="file" id="taskPhotos" multiple accept="image/*" />
        </div>
      </div>
      <div style="display:flex;gap:.5rem;margin-top:.75rem">
        <button class="btn primary" id="taskSave">Save</button>
        <button class="btn danger" id="taskDelete">Delete</button>
        <button class="btn" value="cancel">Close</button>
      </div>
    </form>
  </dialog>

  <script>
    // === Configuration ===
    const AZURE_AD = {
      clientId: "827656f8-3a21-4d69-b6e5-c35e2ec2fb71",
      authority: "https://login.microsoftonline.com/97d84781-b85c-4034-a0d0-588e7b442e45",
      redirectUri: "https://abirrahat.github.io/wolcas-webapp/auth"
    };
    const GRAPH_SCOPES = ["User.Read","Group.Read.All","Sites.ReadWrite.All","Files.ReadWrite.All"];

    // SharePoint site information derived from provided URLs
    const SP_HOST = "architektica-my.sharepoint.com"; // hostname
    const SP_SITE_PATH = "/personal/abir_architektica_com"; // site path
    const LIST_DISPLAY_NAMES = { Project: "Project", Task: "Task" };

    // Optional RBAC via AAD groups (edit names to match your tenant)
    const RBAC_GROUPS = {
      admin: ["WOLCAS Admins"],
      editor: ["WOLCAS Editors"],
      viewer: ["WOLCAS Viewers"]
    };

    // === MSAL Setup ===
    const msalConfig = {
      auth: { clientId: AZURE_AD.clientId, authority: AZURE_AD.authority, redirectUri: AZURE_AD.redirectUri },
      cache: { cacheLocation: "sessionStorage", storeAuthStateInCookie: false },
      system: { allowRedirectInIframe: true }
    };
    const msalInstance = new msal.PublicClientApplication(msalConfig);
    let account = null;

    // UI elements
    const signinCard = document.getElementById("signinCard");
    const appContent = document.getElementById("appContent");
    const signinStart = document.getElementById("signinStart");
    const signinBtn = document.getElementById("signinBtn");
    const signoutBtn = document.getElementById("signoutBtn");
    const userEmailSpan = document.getElementById("userEmail");

    const addProjectBtn = document.getElementById("addProjectBtn");
    const projectsTableBody = document.querySelector("#projectsTable tbody");
    const projectModal = document.getElementById("projectModal");
    const projectForm = document.getElementById("projectForm");
    const projectSaveBtn = document.getElementById("projectSave");
    const projectDeleteBtn = document.getElementById("projectDelete");

    const addTaskBtn = document.getElementById("addTaskBtn");
    const tasksTableBody = document.querySelector("#tasksTable tbody");
    const taskModal = document.getElementById("taskModal");
    const taskForm = document.getElementById("taskForm");
    const taskSaveBtn = document.getElementById("taskSave");
    const taskDeleteBtn = document.getElementById("taskDelete");
    const allocationInput = document.getElementById("AllocationInput");
    const taskPhotosInput = document.getElementById("taskPhotos");

    // App state
    let siteId = null, driveId = null, listIds = { Project: null, Task: null };
    let role = "viewer"; // default locked down
    let currentProjectItem = null; // for binder
    let currentTaskItem = null;

    function setSignedInUI(isSignedIn){
      signinCard.classList.toggle("hidden", isSignedIn);
      appContent.classList.toggle("hidden", !isSignedIn);
      signoutBtn.disabled = !isSignedIn;
      signinBtn.disabled = isSignedIn;
    }

    function setRoleUI(){
      // RBAC: hide add buttons for viewer; hide delete buttons unless admin; lock Allocation unless admin
      addProjectBtn.classList.toggle("hidden", role === "viewer");
      addTaskBtn.classList.toggle("hidden", role === "viewer");
      projectDeleteBtn.classList.toggle("hidden", role !== "admin");
      taskDeleteBtn.classList.toggle("hidden", role !== "admin");
      allocationInput.disabled = role !== "admin"; // per-field RBAC
    }

    async function signIn(){
      try{
        const loginResponse = await msalInstance.loginPopup({ scopes: GRAPH_SCOPES });
        account = loginResponse.account;
        userEmailSpan.textContent = account.username || account.homeAccountId;
        setSignedInUI(true);
        await postLoginInit();
      }catch(err){
        console.error("Sign-in failed", err);
        alert("Sign-in failed: " + (err.errorCode || err.message));
      }
    }

    function signOut(){
      if(!account){return}
      msalInstance.logoutPopup({ account });
      account = null; userEmailSpan.textContent = "Not signed in"; setSignedInUI(false);
    }

    async function getToken(){
      if(!account){ throw new Error("No account") }
      try{
        const res = await msalInstance.acquireTokenSilent({ account, scopes: GRAPH_SCOPES });
        return res.accessToken;
      }catch(_){
        const res = await msalInstance.acquireTokenPopup({ account, scopes: GRAPH_SCOPES });
        return res.accessToken;
      }
    }

    async function graph(endpoint, method="GET", body=null, headers={}){
      const token = await getToken();
      const res = await fetch("https://graph.microsoft.com/v1.0" + endpoint, {
        method,
        headers: { "Authorization":"Bearer "+token, "Content-Type":"application/json", ...headers },
        body: body ? JSON.stringify(body) : null
      });
      if(!res.ok){
        const text = await res.text();
        throw new Error(method+" "+endpoint+" => "+res.status+" " + text);
      }
      return res.status === 204 ? null : res.json();
    }

    async function detectRole(){
      // Default: viewer; upgrade based on group membership
      try{
        const meGroups = await graph("/me/memberOf?$select=displayName");
        const names = (meGroups.value||[]).map(g => g.displayName);
        const isAdmin = RBAC_GROUPS.admin.some(n => names.includes(n));
        const isEditor = RBAC_GROUPS.editor.some(n => names.includes(n));
        role = isAdmin ? "admin" : (isEditor ? "editor" : "viewer");
      }catch(e){ console.warn("Group lookup failed, defaulting to viewer", e); role = "viewer"; }
      setRoleUI();
    }

    async function resolveSiteAndLists(){
      // Resolve site id by path
      const site = await graph(`/sites/${SP_HOST}:${SP_SITE_PATH}`);
      siteId = site.id;
      // Default document library (drive)
      const drive = await graph(`/sites/${siteId}/drive`);
      driveId = drive.id;
      // Resolve list ids by displayName
      const lists = await graph(`/sites/${siteId}/lists?$select=id,displayName`);
      for(const l of lists.value){
        if(l.displayName === LIST_DISPLAY_NAMES.Project){ listIds.Project = l.id; }
        if(l.displayName === LIST_DISPLAY_NAMES.Task){ listIds.Task = l.id; }
      }
      if(!listIds.Project || !listIds.Task){ throw new Error("Required lists not found: Project/Task") }
    }

    async function ensureTaskPhotosFolder(){
      // Ensure TaskPhotos folder exists under Documents
      const children = await graph(`/sites/${siteId}/drive/root/children?$select=name,folder`);
      const exists = children.value.find(c => c.name === "TaskPhotos" && c.folder);
      if(!exists){
        await graph(`/sites/${siteId}/drive/root/children`, "POST", { name:"TaskPhotos", folder:{}, "@microsoft.graph.conflictBehavior":"fail" });
      }
    }

    // === Projects ===
    async function loadProjects(){
      const items = await graph(`/sites/${siteId}/lists/${listIds.Project}/items?$top=8&expand=fields`);
      renderProjects(items.value || []);
    }

    function renderProjects(items){
      projectsTableBody.innerHTML = "";
      for(const it of items){
        const f = it.fields || {};
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${escapeHtml(f.Title||"")}</td>
          <td>${escapeHtml(f.Owner||"")}</td>
          <td>${escapeHtml(f.StartDate||"")}</td>
          <td>${escapeHtml(f.ExpectedSales||"")}</td>
          <td>${f.Active?"Yes":"No"}</td>
          <td>
            <button class="btn" data-id="${it.id}" data-action="editProject">Edit</button>
            ${role === 'admin' ? `<button class='btn danger' data-id='${it.id}' data-action='deleteProject'>Delete</button>` : ''}
          </td>`;
        projectsTableBody.appendChild(tr);
      }
    }

    function openProjectModal(item){
      currentProjectItem = item || null;
      projectForm.reset();
      projectDeleteBtn.classList.toggle("hidden", role !== "admin" || !item);
      if(item){
        const f = item.fields||{};
        projectForm.querySelector("[name=Title]").value = f.Title||"";
        projectForm.querySelector("[name=Owner]").value = f.Owner||"";
        projectForm.querySelector("[name=StartDate]").value = f.StartDate||"";
        projectForm.querySelector("[name=ExpectedSales]").value = f.ExpectedSales||"";
        projectForm.querySelector("[name=Active]").checked = !!f.Active;
      }
      projectModal.showModal();
    }

    async function saveProject(){
      const fields = collectFormFields(projectForm);
      const payload = { fields };
      if(currentProjectItem?.id){
        await graph(`/sites/${siteId}/lists/${listIds.Project}/items/${currentProjectItem.id}/fields`, "PATCH", fields);
      }else{
        currentProjectItem = await graph(`/sites/${siteId}/lists/${listIds.Project}/items`, "POST", payload);
      }
      await loadProjects();
      projectModal.close();
    }

    async function deleteProject(id){
      if(role !== "admin") return alert("Only admins can delete.");
      if(!confirm("Delete this project?")) return;
      await graph(`/sites/${siteId}/lists/${listIds.Project}/items/${id}`, "DELETE");
      await loadProjects();
    }

    // Binder: auto create/update when fields change
    let binderTimeout = null;
    projectForm.addEventListener("input", ()=>{
      clearTimeout(binderTimeout);
      binderTimeout = setTimeout(async ()=>{
        try{ await saveProject(); }catch(e){ console.warn("Binder save failed", e); }
      }, 800);
    });

    // === Tasks ===
    async function loadTasks(){
      const items = await graph(`/sites/${siteId}/lists/${listIds.Task}/items?$top=50&expand=fields`);
      renderTasks(items.value || []);
    }

    function renderTasks(items){
      tasksTableBody.innerHTML = "";
      for(const it of items){
        const f = it.fields || {};
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${escapeHtml(f.Title||"")}</td>
          <td>${escapeHtml(f.Address||"")}</td>
          <td>${escapeHtml(f.StartDate||"")}</td>
          <td>${escapeHtml(f.EndDate||"")}</td>
          <td>${escapeHtml(f.Quantity||"")}</td>
          <td>${escapeHtml(f.UnitCost||"")}</td>
          <td>${escapeHtml(f.TotalCost||"")}</td>
          <td>${escapeHtml(f.Allocation||"")}</td>
          <td>${escapeHtml(f.Sprint||"")}</td>
          <td>${escapeHtml(f.Assignee||"")}</td>
          <td>
            ${role !== 'viewer' ? `<button class='btn' data-id='${it.id}' data-action='editTask'>Edit</button>` : ''}
            ${role === 'admin' ? `<button class='btn danger' data-id='${it.id}' data-action='deleteTask'>Delete</button>` : ''}
          </td>`;
        tasksTableBody.appendChild(tr);
      }
    }

    function openTaskModal(item){
      currentTaskItem = item || null;
      taskForm.reset();
      taskDeleteBtn.classList.toggle("hidden", role !== "admin" || !item);
      if(item){
        const f = item.fields||{};
        for(const k of ["Title","Address","StartDate","EndDate","Quantity","UnitCost","TotalCost","Allocation","Sprint","Assignee","Description","Notes"]){
          const el = taskForm.querySelector(`[name=${k}]`);
          if(el){ el.value = f[k] || ""; }
        }
      }
      taskModal.showModal();
    }

    async function saveTask(){
      const fields = collectFormFields(taskForm);
      const payload = { fields };
      // Per-field RBAC: prevent non-admins from changing Allocation
      if(currentTaskItem?.fields && role !== "admin"){
        fields.Allocation = currentTaskItem.fields.Allocation;
      }
      let itemId = currentTaskItem?.id;
      if(itemId){
        await graph(`/sites/${siteId}/lists/${listIds.Task}/items/${itemId}/fields`, "PATCH", fields);
      }else{
        const created = await graph(`/sites/${siteId}/lists/${listIds.Task}/items`, "POST", payload);
        itemId = created.id;
        currentTaskItem = created;
      }
      // Photos upload (optional)
      const files = taskPhotosInput.files;
      if(files && files.length){
        await ensureTaskPhotosFolder();
        const links = [];
        for(const file of files){
          const safeName = sanitizeFileName(file.name);
          const uploadUrl = `/sites/${siteId}/drive/root:/TaskPhotos/${encodeURIComponent(safeName)}:/content`;
          const token = await getToken();
          const res = await fetch("https://graph.microsoft.com/v1.0" + uploadUrl, {
            method:"PUT",
            headers: { "Authorization":"Bearer "+token, "Content-Type": file.type || "application/octet-stream" },
            body: file
          });
          if(res.ok){
            const driveItem = await res.json();
            links.push(driveItem.webUrl);
          }else{
            const errText = await res.text();
            console.error("Upload failed", errText);
            alert("Photo upload failed: " + errText);
          }
        }
        if(links.length){
          await graph(`/sites/${siteId}/lists/${listIds.Task}/items/${itemId}/fields`, "PATCH", { Photos: links.join("; ") });
        }
      }
      await loadTasks();
      taskModal.close();
    }

    async function deleteTask(id){
      if(role !== "admin") return alert("Only admins can delete.");
      if(!confirm("Delete this task?")) return;
      await graph(`/sites/${siteId}/lists/${listIds.Task}/items/${id}`, "DELETE");
      await loadTasks();
    }

    function collectFormFields(form){
      const fields = {};
      for(const el of form.querySelectorAll("input,textarea,select")){
        if(!el.name) continue;
        if(el.type === "checkbox") fields[el.name] = el.checked;
        else fields[el.name] = el.value;
      }
      return fields;
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>\"]/g, c => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c]));
    }
    function sanitizeFileName(name){
      return name.replace(/[^A-Za-z0-9._-]/g, "_");
    }

    async function postLoginInit(){
      await detectRole();
      await resolveSiteAndLists();
      await Promise.all([loadProjects(), loadTasks()]);
    }

    // Table row action handlers
    document.addEventListener("click", (e)=>{
      const btn = e.target.closest("button");
      if(!btn) return;
      const action = btn.getAttribute("data-action");
      const id = btn.getAttribute("data-id");
      if(action === "editProject"){
        // fetch item fields
        graph(`/sites/${siteId}/lists/${listIds.Project}/items/${id}?expand=fields`).then(item => openProjectModal(item));
      }else if(action === "deleteProject"){
        deleteProject(id);
      }else if(action === "editTask"){
        graph(`/sites/${siteId}/lists/${listIds.Task}/items/${id}?expand=fields`).then(item => openTaskModal(item));
      }else if(action === "deleteTask"){
        deleteTask(id);
      }
    });

    // Buttons
    signinStart.addEventListener("click", signIn);
    signinBtn.addEventListener("click", signIn);
    signoutBtn.addEventListener("click", signOut);

    addProjectBtn.addEventListener("click", ()=> openProjectModal(null));
    projectSaveBtn.addEventListener("click", (ev)=>{ ev.preventDefault(); saveProject(); });
    projectDeleteBtn.addEventListener("click", (ev)=>{ ev.preventDefault(); if(currentProjectItem?.id) deleteProject(currentProjectItem.id); });

    addTaskBtn.addEventListener("click", ()=> openTaskModal(null));
    taskSaveBtn.addEventListener("click", (ev)=>{ ev.preventDefault(); saveTask(); });
    taskDeleteBtn.addEventListener("click", (ev)=>{ ev.preventDefault(); if(currentTaskItem?.id) deleteTask(currentTaskItem.id); });

    // Initial locked UI
    setSignedInUI(false);

    // SECURITY NOTE: Client secret must NEVER be included in this browser app.
    // The app uses MSAL PKCE public-client flow and Graph scopes: User.Read, Group.Read.All, Sites.ReadWrite.All, Files.ReadWrite.All.
  </script>
</body>
</html>

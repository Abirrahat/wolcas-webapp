<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Auth</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; base-uri 'self'; object-src 'none'; frame-ancestors 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; connect-src 'self' https://login.microsoftonline.com;" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial; margin:0; padding:18px; background:#fff; }
    .muted { color:#6b7280; }
  </style>
</head>
<body>
  <div class="muted">Completing sign-in… You can close this window if it doesn’t close automatically.</div>

  <script src="../msal-browser.min.js"></script>
  <script>
    // This page is used as a dedicated redirectUri for MSAL popup flows.
    // It processes the response and closes itself.

    const AAD = {
      clientId: '827656f8-3a21-4d69-b6e5-c35e2ec2fb71',
      tenantId: '97d84781-b85c-4034-a0d0-588e7b442e45',
      appUrl: 'https://abirrahat.github.io/wolcas-webapp/',
      authUrl: 'https://abirrahat.github.io/wolcas-webapp/auth'
    };

    const msalConfig = {
      auth: {
        clientId: AAD.clientId,
        authority: `https://login.microsoftonline.com/${AAD.tenantId}`,
        redirectUri: AAD.authUrl,
        navigateToLoginRequestUrl: false
      },
      cache: {
        cacheLocation: 'sessionStorage',
        storeAuthStateInCookie: false
      }
    };

    (async () => {
      try {
        const msalInstance = new msal.PublicClientApplication(msalConfig);
        await msalInstance.initialize();
        await msalInstance.handleRedirectPromise();
      } catch (e) {
        // Swallow errors; main window will show them.
        console.warn(e);
      } finally {
        // Give MSAL a tick to finish storage writes, then close.
        setTimeout(() => window.close(), 50);
      }
    })();
  </script>
</body>
</html>
